---

- name: Check if html/typo3cms exists
  local_action: stat path="{{ deployment_base }}/html/typo3cms"
  register: typo3cms_inside_html
  run_once: True

- name: Check if typo3cms exists
  local_action: stat path="{{ deployment_base }}/typo3cms"
  register: typo3cms_inside_root
  run_once: True

- name: Create /typo3cms (if html/typo3cms exists and /typo3cms not)
  local_action: file src=html/typo3cms dest=typo3cms state=link
  run_once: True
  when: (typo3cms_inside_html.stat.exists is defined and typo3cms_inside_root.stat.exists is defined) and
        (typo3cms_inside_html.stat.exists == True and typo3cms_inside_root.stat.exists == False)
